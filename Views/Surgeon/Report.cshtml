@model IEnumerable<WIRKDEVELOPER.Models.Booking>

@{
    ViewBag.Title = "Surgery Report";
    Layout = "~/Views/Shared/SurgeonLayout.cshtml";
    var reportGeneratedDate = DateTime.Now.ToString("dd MMMM yyyy");
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>@ViewBag.Title</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        h1, h2 {
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

            .table, .table th, .table td {
                border: 1px solid black;
            }

                .table th, .table td {
                    padding: 8px;
                    text-align: left;
                }

        .summary {
            margin-top: 30px;
        }

        .footer {
            margin-top: 50px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>Surgery Report</h1>

    <!-- Form to select the date range -->
    @using (Html.BeginForm("Index", "Surgeon", FormMethod.Post))
    {
        <div class="form-group">
            <label for="startDate">Start Date:</label>
            @Html.TextBox("startDate", ViewBag.StartDate as string, new { type = "date", @class = "form-control" })
        </div>
        <div class="form-group">
            <label for="endDate">End Date:</label>
            @Html.TextBox("endDate", ViewBag.EndDate as string, new { type = "date", @class = "form-control" })
        </div>
        <div>
            <button type="submit" class="btn btn-primary">Generate Report</button>
        </div>
    }

    <!-- Conditionally display the report if there is data -->
    @if (Model != null && Model.Any())
    {
        <h2>For the period: @ViewBag.StartDate to @ViewBag.EndDate</h2>

        <div>
            <strong>Report Generated:</strong> @reportGeneratedDate
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Patient</th>
                    <th>Treatment Code(s)</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model)
                {
                    <tr>
                        <td>@booking.Date.ToShortDateString()</td>
                        <td>@booking.Name @booking.Surname</td>
                        <td>
                            @if (booking.BookingTreatmentCodes != null && booking.BookingTreatmentCodes.Any())
                            {
                                @string.Join(", ", booking.BookingTreatmentCodes.Select(tc => tc.TreatmentCode?.ICDCODE ?? "N/A"))
                            }
                            else
                            {
                                <span>No Treatment Codes</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="summary">
            <h3>Summary:</h3>
            <ul>
                <li>Total Patients: @Model.Count()</li>
                <li>Total Treatments: @Model.SelectMany(b => b.BookingTreatmentCodes).Count()</li>
            </ul>
        </div>

        <!-- Add a button to download the report as PDF -->
        <div>
            @Html.ActionLink("Download PDF", "DownloadReportAsPdf", new { startDate = ViewBag.StartDate, endDate = ViewBag.EndDate }, new { @class = "btn btn-success" })
        </div>
    }

</body>
</html>

