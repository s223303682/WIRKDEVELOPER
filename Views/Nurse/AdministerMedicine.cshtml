@* @{
    ViewData["Title"] = "Administer Medicine";
    Layout = "~/Views/Shared/_NurseLayout.cshtml";
}
@model IEnumerable<MedicationPrescription>
<head>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.bootstrap4.min.css" />
</head>
@if (!Model.Any())
{
    <div class="card">
        <div class="card-body">
            <h3>No Data Was found</h3>
        </div>
    </div>
}
else
{
    <div id="Header" class="bg-info">
        <h2 class="m-1 pt-4 text-center text-white">Patient</h2>
    </div>
    <div class="card">
        <div class="card-body">
            <p>
                Patient Name: @Model.First().Prescription.Patient.PatientName @Model.First().Prescription.Patient.PatientName <br />
                Surgeon Name: @Model.First().Prescription.Surgeon.ApplicationUser.FirstName @Model.First().Prescription.Surgeon.ApplicationUser.LastName <br />
                Priority: @Model.First().Prescription.Urgent
            </p>
        </div>
    </div>
    <div class="container-fluid bg-white border p-4">
        <table id="myTable" table class="table table-hover  table-sm" style="width:100%">
            <thead class="table-secondary">
                <tr>
                    <th>Medicine</th>
                    <th>Instructions</th>
                    <th>Quantity</th>
                    <th>Quantity Already Administered</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var sche in Model)
                {
                    <tr>

                        <td width="20%">@sche.PharmacyMedication.PharmacyMedicationName</td>
                        <td width="20%">@sche.Instruction</td>
                        <td width="20%">@sche.Quantity</td>
                        <td width="20%">@sche.QuantityGiven</td>
                        @if (sche.QuantityGiven < sche.Quantity)
                        {
                            <td>
                                <input id="@sche.MedicationPrescriptionID" class="form-control" min="0" type="number" name="data" />
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
        <div class="row">
            <div class="col-3">
                <a class="btn btn-outline-success" onclick="Submit()">Submit</a>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.bootstrap4.min.js"></script>
    <script>
        function Submit() {
            list = []
            $("input[name*=data]").each(function () {
                var x = { MedId: $(this).attr('id'), Quantity: $(this).val() }
                list.push(x)
            });
            $.ajax({
                type: "POST",
                url: "@Url.Action("AdministerMeds")",
                data: JSON.stringify(list),
                dataType: "Json",
                contentType: "application/json",
                success: function (result) {
                    if(result){
                        alert("Successfully submitted")
                        window.location.href = "@Url.Action("PatientPrescriptions", "Nurse", new { i = @Model.First().Prescription.PatientID })"
                    }
                    else{
                        alert("Something went wrong. Refresh the page")
                    }

                }
            });
        }

    </script>
}





 *@